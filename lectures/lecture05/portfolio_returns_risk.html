<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.361">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Investments - Portfolio Returns and Risk</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">
      Investments
      </li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../../">Investments</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../schedule.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Schedule</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../syllabus.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Syllabus</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Lectures</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="false">
 <span class="menu-text">Lecture 1: The Investment Environment</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../lectures/lecture01/lecture.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Pre-class Reading</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="false">
 <span class="menu-text">Lecture 2: Foundations of Financial Markets</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../lectures/lecture02/lecture.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Pre-class Reading</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../lectures/lecture02/lab.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="false">
 <span class="menu-text">Lecture 3: Measuring and Comparing Returns</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../lectures/lecture03/lecture.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Pre-class Reading</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../lectures/lecture03/lab.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="false">
 <span class="menu-text">Lecture 4: Measuring Risk and Expected Return</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../lectures/lecture04/lecture.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Pre-class Reading</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../lectures/lecture04/lab.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="false">
 <span class="menu-text">Lecture 5: Portfolio Risk and Returns</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../lectures/lecture05/lecture.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Pre-class Reading</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../lectures/lecture05/lab.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="false">
 <span class="menu-text">Lecture 6: Optimal Capital Allocation</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../lectures/lecture06/lecture.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Pre-class Reading</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../lectures/lecture06/lab.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" aria-expanded="false">
 <span class="menu-text">Lecture 7: Mean-Variance Portfolio Optimization</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-8" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../lectures/lecture07/lecture.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Pre-class Reading</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../lectures/lecture07/lab.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" aria-expanded="false">
 <span class="menu-text">Lecture 8: Optimal Asset Allocation</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-9" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../lectures/lecture08/lecture.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Pre-class Reading</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../lectures/lecture08/lab.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-10" aria-expanded="false">
 <span class="menu-text">Lecture 9: Review Session</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-10" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-10" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../lectures/lecture09/lab.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="header-section-number">1</span> Introduction</a></li>
  <li><a href="#portfolio-weights-and-realized-returns" id="toc-portfolio-weights-and-realized-returns" class="nav-link" data-scroll-target="#portfolio-weights-and-realized-returns"><span class="header-section-number">2</span> Portfolio Weights and Realized Returns</a></li>
  <li><a href="#portfolio-expected-returns" id="toc-portfolio-expected-returns" class="nav-link" data-scroll-target="#portfolio-expected-returns"><span class="header-section-number">3</span> Portfolio Expected Returns</a></li>
  <li><a href="#correlation-and-covariance-between-return-series" id="toc-correlation-and-covariance-between-return-series" class="nav-link" data-scroll-target="#correlation-and-covariance-between-return-series"><span class="header-section-number">4</span> Correlation and Covariance Between Return Series</a></li>
  <li><a href="#portfolio-total-risk" id="toc-portfolio-total-risk" class="nav-link" data-scroll-target="#portfolio-total-risk"><span class="header-section-number">5</span> Portfolio Total Risk</a></li>
  <li><a href="#key-takeaways" id="toc-key-takeaways" class="nav-link" data-scroll-target="#key-takeaways"><span class="header-section-number">6</span> Key Takeaways</a></li>
  <li><a href="#key-formulas-summary" id="toc-key-formulas-summary" class="nav-link" data-scroll-target="#key-formulas-summary"><span class="header-section-number">7</span> Key Formulas Summary</a></li>
  <li><a href="#practice-problems" id="toc-practice-problems" class="nav-link" data-scroll-target="#practice-problems"><span class="header-section-number">8</span> Practice Problems</a></li>
  <li><a href="#ask-an-llm" id="toc-ask-an-llm" class="nav-link" data-scroll-target="#ask-an-llm"><span class="header-section-number">9</span> Ask an LLM</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Portfolio Returns and Risk</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="introduction" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="introduction"><span class="header-section-number">1</span> Introduction</h2>
<p>When you own a single stock, understanding its risk and return is relatively straightforward—you simply examine that stock’s historical performance and volatility. But the moment you hold two or more assets, something fundamentally changes. Your portfolio becomes more than the sum of its parts, and the interactions between assets create outcomes that can be surprising and, when properly managed, beneficial.</p>
<p>This lecture introduces the mathematical framework for understanding how portfolios behave. We begin with a simple but crucial insight: a portfolio’s return is determined by two things—what you own and how much of each thing you own. These “how much” quantities are called portfolio weights, and they are the foundation of everything that follows. From there, we develop the tools to calculate both the expected return and the risk of any portfolio, no matter how many assets it contains.</p>
<p>The key revelation of portfolio theory is that risk does not combine the way returns do. While a portfolio’s expected return is simply a weighted average of its components’ expected returns, portfolio risk depends critically on how assets move together. Two stocks that tend to zig when each other zags can combine to create a portfolio that is less volatile than either stock alone. This insight—that diversification can reduce risk without sacrificing expected return—is one of the most important ideas in all of finance.</p>
<p>By the end of this lecture, you will be able to calculate portfolio returns over any holding period, estimate expected returns and total risk for portfolios of any size, and understand why the covariance between assets is the crucial ingredient that makes diversification work.</p>
</section>
<section id="portfolio-weights-and-realized-returns" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="portfolio-weights-and-realized-returns"><span class="header-section-number">2</span> Portfolio Weights and Realized Returns</h2>
<p>Every portfolio can be completely described by answering two questions: What assets are in the portfolio? And what fraction of the portfolio’s value does each asset represent? These fractions are called portfolio weights, and they are the starting point for all portfolio calculations.</p>
<p>Consider a portfolio containing <span class="math inline">\(N\)</span> assets. Let <span class="math inline">\(M_i\)</span> represent the market value of asset <span class="math inline">\(i\)</span> at the beginning of some measurement period—this is simply the price per share multiplied by the number of shares held. The weight of asset <span class="math inline">\(i\)</span> in the portfolio is defined as:</p>
<p><span class="math display">\[w_i = \frac{M_i}{M_1 + M_2 + \cdots + M_N}\]</span></p>
<p>where <span class="math inline">\(w_i\)</span> is the weight of asset <span class="math inline">\(i\)</span>, <span class="math inline">\(M_i\)</span> is the market value of asset <span class="math inline">\(i\)</span>, and the denominator is the total portfolio value. Notice that weights must always sum to one: if you add up every asset’s fraction of the total, you get the whole portfolio.</p>
<p>Once we know the weights, calculating the portfolio’s return over a period becomes straightforward. If asset <span class="math inline">\(i\)</span> earns a return of <span class="math inline">\(R_i\)</span> during the period, the portfolio return is:</p>
<p><span class="math display">\[R_P = w_1 R_1 + w_2 R_2 + \cdots + w_N R_N = \sum_{i=1}^{N} w_i R_i\]</span></p>
<p>where <span class="math inline">\(R_P\)</span> is the portfolio return, <span class="math inline">\(w_i\)</span> is the weight of asset <span class="math inline">\(i\)</span>, and <span class="math inline">\(R_i\)</span> is the return of asset <span class="math inline">\(i\)</span>. This formula tells us that the portfolio return is a weighted average of the individual asset returns. An asset that represents 60% of your portfolio contributes 60% of its return to the portfolio return, while an asset representing only 10% contributes proportionally less.</p>
<p>One subtlety deserves attention: weights change over time as asset prices change. After one period of returns, the market values of your holdings will have shifted, and with them the weights. If one stock doubles while another stays flat, the first stock now represents a larger fraction of your portfolio. This means that calculating multi-period returns requires updating weights at the end of each period before computing the next period’s return.</p>
<p><strong>Example 1</strong></p>
<p><em>Suppose today Meta (META) is selling for $200 per share and Netflix (NFLX) is selling for $400 per share. You buy two shares of META and one share of NFLX. Over the next month, META has a return of 10% and NFLX has a return of 20%. The month after that, META has a return of -10% and NFLX has a return of -20%. What will be the return of the portfolio over each month? What will the return of your portfolio be over this entire two-month period?</em></p>
<div class="callout callout-style-default callout-note callout-titled" title="Solution">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><strong>Step 1: Calculate initial portfolio values and weights</strong></p>
<p>At the start of Month 1:</p>
<ul>
<li>META: 2 shares × $200 = $400</li>
<li>NFLX: 1 share × $400 = $400</li>
<li>Total portfolio value: $800</li>
</ul>
<p>Initial weights:</p>
<ul>
<li><span class="math inline">\(w_{META} = \$400 / \$800 = 0.50\)</span> (50%)</li>
<li><span class="math inline">\(w_{NFLX} = \$400 / \$800 = 0.50\)</span> (50%)</li>
</ul>
<p><strong>Step 2: Calculate Month 1 return</strong></p>
<p><span class="math display">\[R_{P,1} = w_{META} \times R_{META} + w_{NFLX} \times R_{NFLX}\]</span> <span class="math display">\[R_{P,1} = 0.50 \times 10\% + 0.50 \times 20\% = 5\% + 10\% = 15\%\]</span></p>
<p><strong>Step 3: Calculate new portfolio values and weights for Month 2</strong></p>
<p>At the end of Month 1 (start of Month 2):</p>
<ul>
<li>META value: $400 × (1 + 0.10) = $440</li>
<li>NFLX value: $400 × (1 + 0.20) = $480</li>
<li>Total portfolio value: $920</li>
</ul>
<p>New weights:</p>
<ul>
<li><span class="math inline">\(w_{META} = \$440 / \$920 = 0.478\)</span> (47.8%)</li>
<li><span class="math inline">\(w_{NFLX} = \$480 / \$920 = 0.522\)</span> (52.2%)</li>
</ul>
<p><strong>Step 4: Calculate Month 2 return using new weights</strong></p>
<p><span class="math display">\[R_{P,2} = 0.478 \times (-10\%) + 0.522 \times (-20\%)\]</span> <span class="math display">\[R_{P,2} = -4.78\% + (-10.44\%) = -15.22\%\]</span></p>
<p><strong>Step 5: Calculate two-month total return</strong></p>
<p>The total two-month return compounds the monthly returns:</p>
<p><span class="math display">\[R_{total} = (1 + R_{P,1}) \times (1 + R_{P,2}) - 1\]</span> <span class="math display">\[R_{total} = (1 + 0.15) \times (1 - 0.1522) - 1\]</span> <span class="math display">\[R_{total} = 1.15 \times 0.8478 - 1 = 0.975 - 1 = -2.5\%\]</span></p>
<p>Alternatively, we can verify using ending and beginning portfolio values:</p>
<ul>
<li>Final META value: $440 × (1 - 0.10) = $396</li>
<li>Final NFLX value: $480 × (1 - 0.20) = $384</li>
<li>Final portfolio value: $780</li>
</ul>
<p><span class="math display">\[R_{total} = \frac{\$780 - \$800}{\$800} = -2.5\%\]</span></p>
<p><strong>Summary:</strong> Month 1 return = 15%, Month 2 return = -15.22%, Two-month total return = -2.5%</p>
</div>
</div>
</div>
</section>
<section id="portfolio-expected-returns" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="portfolio-expected-returns"><span class="header-section-number">3</span> Portfolio Expected Returns</h2>
<p>While realized returns tell us what happened in the past, investment decisions require thinking about the future. The expected return of a portfolio represents our best estimate of what the portfolio will earn, on average, going forward.</p>
<p>The formula for expected portfolio return has the same elegant structure as the formula for realized returns—it is simply a weighted average:</p>
<p><span class="math display">\[E[R_P] = w_1 E[R_1] + w_2 E[R_2] + \cdots + w_N E[R_N] = \sum_{i=1}^{N} w_i E[R_i]\]</span></p>
<p>where <span class="math inline">\(E[R_P]\)</span> is the expected portfolio return, <span class="math inline">\(w_i\)</span> is the weight of asset <span class="math inline">\(i\)</span>, and <span class="math inline">\(E[R_i]\)</span> is the expected return of asset <span class="math inline">\(i\)</span>. This formula carries an important implication: you cannot create expected return out of thin air through clever portfolio construction. The portfolio’s expected return is bounded by the expected returns of its components. If all your assets have expected returns between 5% and 12%, your portfolio’s expected return must also fall within that range.</p>
<p>In practice, we typically estimate expected returns using historical average returns, though more sophisticated approaches exist. The sample mean of historical returns provides an estimate of what we might expect going forward, with the important caveat that past performance does not guarantee future results.</p>
<p>For portfolios with just two or three assets, the formula simplifies to familiar forms that are worth memorizing:</p>
<table class="table">
<thead>
<tr class="header">
<th style="text-align: left;">Portfolio Size</th>
<th style="text-align: left;">Expected Return Formula</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Two assets</td>
<td style="text-align: left;"><span class="math inline">\(E[R_P] = w_1 E[R_1] + w_2 E[R_2]\)</span></td>
</tr>
<tr class="even">
<td style="text-align: left;">Three assets</td>
<td style="text-align: left;"><span class="math inline">\(E[R_P] = w_1 E[R_1] + w_2 E[R_2] + w_3 E[R_3]\)</span></td>
</tr>
</tbody>
</table>
<p><strong>Example 2</strong></p>
<p><em>Suppose over the past three months META had returns of 10%, 10%, and -8%, and NFLX had returns of 20%, -10%, and -1%. Today, you invest $1,000 in META and $4,000 in NFLX. What is the expected return of your portfolio?</em></p>
<div class="callout callout-style-default callout-note callout-titled" title="Solution">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><strong>Step 1: Calculate portfolio weights</strong></p>
<ul>
<li>Total investment: $1,000 + $4,000 = $5,000</li>
<li><span class="math inline">\(w_{META} = \$1,000 / \$5,000 = 0.20\)</span> (20%)</li>
<li><span class="math inline">\(w_{NFLX} = \$4,000 / \$5,000 = 0.80\)</span> (80%)</li>
</ul>
<p><strong>Step 2: Estimate expected returns using historical averages</strong></p>
<p>For META: <span class="math display">\[E[R_{META}] = \frac{10\% + 10\% + (-8\%)}{3} = \frac{12\%}{3} = 4\%\]</span></p>
<p>For NFLX: <span class="math display">\[E[R_{NFLX}] = \frac{20\% + (-10\%) + (-1\%)}{3} = \frac{9\%}{3} = 3\%\]</span></p>
<p><strong>Step 3: Calculate expected portfolio return</strong></p>
<p><span class="math display">\[E[R_P] = w_{META} \times E[R_{META}] + w_{NFLX} \times E[R_{NFLX}]\]</span> <span class="math display">\[E[R_P] = 0.20 \times 4\% + 0.80 \times 3\%\]</span> <span class="math display">\[E[R_P] = 0.8\% + 2.4\% = 3.2\%\]</span></p>
<p><strong>The expected return of the portfolio is 3.2% per month.</strong></p>
</div>
</div>
</div>
</section>
<section id="correlation-and-covariance-between-return-series" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="correlation-and-covariance-between-return-series"><span class="header-section-number">4</span> Correlation and Covariance Between Return Series</h2>
<p>Before we can understand portfolio risk, we need to understand how different assets move together. Do they tend to rise and fall at the same time, or do they move independently, or do they actually move in opposite directions? The statistical measures that capture this co-movement are covariance and correlation, and they turn out to be the key ingredients that make diversification possible.</p>
<p>The covariance between two assets measures whether their returns tend to move in the same direction (positive covariance), opposite directions (negative covariance), or show no consistent pattern (covariance near zero). Given historical returns for assets A and B—denoted <span class="math inline">\(R_1^A, R_2^A, \ldots, R_N^A\)</span> and <span class="math inline">\(R_1^B, R_2^B, \ldots, R_N^B\)</span>—the sample covariance is calculated as:</p>
<p><span class="math display">\[Cov_{A,B} = \frac{\sum_{t=1}^{N}(R_t^A - \bar{R}^A)(R_t^B - \bar{R}^B)}{N-1}\]</span></p>
<p>where <span class="math inline">\(Cov_{A,B}\)</span> is the sample covariance between assets A and B, <span class="math inline">\(R_t^A\)</span> and <span class="math inline">\(R_t^B\)</span> are the returns of assets A and B in period <span class="math inline">\(t\)</span>, <span class="math inline">\(\bar{R}^A\)</span> and <span class="math inline">\(\bar{R}^B\)</span> are the sample means (average returns), and <span class="math inline">\(N\)</span> is the number of observations. We divide by <span class="math inline">\(N-1\)</span> rather than <span class="math inline">\(N\)</span> to correct for the bias that arises when estimating a population parameter from a sample.</p>
<p>The intuition behind this formula is elegant: for each time period, we ask whether both assets were above their average (product is positive), both below their average (product is also positive), or on opposite sides of their averages (product is negative). Averaging these products tells us the typical co-movement pattern.</p>
<p>While covariance captures the direction and magnitude of co-movement, its units are difficult to interpret (percent squared). The correlation coefficient solves this by normalizing the covariance:</p>
<p><span class="math display">\[Corr_{A,B} = \frac{Cov_{A,B}}{\sigma^A \sigma^B}\]</span></p>
<p>where <span class="math inline">\(Corr_{A,B}\)</span> is the correlation coefficient, <span class="math inline">\(Cov_{A,B}\)</span> is the covariance, and <span class="math inline">\(\sigma^A\)</span> and <span class="math inline">\(\sigma^B\)</span> are the sample standard deviations of assets A and B. Correlation always falls between -1 and +1, making it much easier to interpret:</p>
<table class="table">
<colgroup>
<col style="width: 54%">
<col style="width: 45%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Correlation Value</th>
<th style="text-align: left;">Interpretation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">+1</td>
<td style="text-align: left;">Perfect positive correlation: assets move in lockstep</td>
</tr>
<tr class="even">
<td style="text-align: left;">0</td>
<td style="text-align: left;">No linear relationship: assets move independently</td>
</tr>
<tr class="odd">
<td style="text-align: left;">-1</td>
<td style="text-align: left;">Perfect negative correlation: assets move in opposite directions</td>
</tr>
</tbody>
</table>
<p>Most pairs of stocks within the same economy have positive correlations—they tend to rise together in good times and fall together in bad times—but the correlation is usually well below 1, leaving room for diversification benefits.</p>
<p><strong>Example 3</strong></p>
<p><em>Suppose over the past three months META had returns of 10%, 10%, and -8%, and NFLX had returns of 20%, -10%, and -1%. Calculate the sample covariance and correlation of the returns of META and NFLX.</em></p>
<div class="callout callout-style-default callout-note callout-titled" title="Solution">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><strong>Step 1: Calculate sample means</strong></p>
<p><span class="math display">\[\bar{R}^{META} = \frac{10\% + 10\% + (-8\%)}{3} = 4\%\]</span></p>
<p><span class="math display">\[\bar{R}^{NFLX} = \frac{20\% + (-10\%) + (-1\%)}{3} = 3\%\]</span></p>
<p><strong>Step 2: Calculate deviations from the mean for each period</strong></p>
<table class="table">
<colgroup>
<col style="width: 7%">
<col style="width: 13%">
<col style="width: 13%">
<col style="width: 32%">
<col style="width: 32%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Month</th>
<th style="text-align: left;"><span class="math inline">\(R^{META}\)</span></th>
<th style="text-align: left;"><span class="math inline">\(R^{NFLX}\)</span></th>
<th style="text-align: left;"><span class="math inline">\(R^{META} - \bar{R}^{META}\)</span></th>
<th style="text-align: left;"><span class="math inline">\(R^{NFLX} - \bar{R}^{NFLX}\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1</td>
<td style="text-align: left;">10%</td>
<td style="text-align: left;">20%</td>
<td style="text-align: left;">10% - 4% = 6%</td>
<td style="text-align: left;">20% - 3% = 17%</td>
</tr>
<tr class="even">
<td style="text-align: left;">2</td>
<td style="text-align: left;">10%</td>
<td style="text-align: left;">-10%</td>
<td style="text-align: left;">10% - 4% = 6%</td>
<td style="text-align: left;">-10% - 3% = -13%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">3</td>
<td style="text-align: left;">-8%</td>
<td style="text-align: left;">-1%</td>
<td style="text-align: left;">-8% - 4% = -12%</td>
<td style="text-align: left;">-1% - 3% = -4%</td>
</tr>
</tbody>
</table>
<p><strong>Step 3: Calculate products of deviations</strong></p>
<table class="table">
<colgroup>
<col style="width: 9%">
<col style="width: 90%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Month</th>
<th style="text-align: left;"><span class="math inline">\((R^{META} - \bar{R}^{META}) \times (R^{NFLX} - \bar{R}^{NFLX})\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1</td>
<td style="text-align: left;">6% × 17% = 0.0102 (or 102 in percentage points squared)</td>
</tr>
<tr class="even">
<td style="text-align: left;">2</td>
<td style="text-align: left;">6% × (-13%) = -0.0078 (or -78 in percentage points squared)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">3</td>
<td style="text-align: left;">(-12%) × (-4%) = 0.0048 (or 48 in percentage points squared)</td>
</tr>
</tbody>
</table>
<p>Sum of products: 0.0102 + (-0.0078) + 0.0048 = 0.0072</p>
<p><strong>Step 4: Calculate sample covariance</strong></p>
<p><span class="math display">\[Cov_{META,NFLX} = \frac{0.0072}{3-1} = \frac{0.0072}{2} = 0.0036\]</span></p>
<p>Or expressed in percentage terms: 0.36% (which equals 36 in percentage points squared)</p>
<p><strong>Step 5: Calculate standard deviations</strong></p>
<p>For META: <span class="math display">\[Var^{META} = \frac{(6\%)^2 + (6\%)^2 + (-12\%)^2}{2} = \frac{0.0036 + 0.0036 + 0.0144}{2} = \frac{0.0216}{2} = 0.0108\]</span></p>
<p><span class="math display">\[\sigma^{META} = \sqrt{0.0108} = 0.1039 = 10.39\%\]</span></p>
<p>For NFLX: <span class="math display">\[Var^{NFLX} = \frac{(17\%)^2 + (-13\%)^2 + (-4\%)^2}{2} = \frac{0.0289 + 0.0169 + 0.0016}{2} = \frac{0.0474}{2} = 0.0237\]</span></p>
<p><span class="math display">\[\sigma^{NFLX} = \sqrt{0.0237} = 0.1539 = 15.39\%\]</span></p>
<p><strong>Step 6: Calculate correlation</strong></p>
<p><span class="math display">\[Corr_{META,NFLX} = \frac{Cov_{META,NFLX}}{\sigma^{META} \times \sigma^{NFLX}} = \frac{0.0036}{0.1039 \times 0.1539} = \frac{0.0036}{0.0160} = 0.225\]</span></p>
<p><strong>Summary:</strong></p>
<ul>
<li>Sample covariance = 0.0036 (or 0.36%)</li>
<li>Sample correlation = 0.225</li>
</ul>
<p>The positive but relatively low correlation (0.225) indicates that META and NFLX tend to move in the same direction, but the relationship is weak. This suggests meaningful diversification benefits from holding both stocks.</p>
</div>
</div>
</div>
</section>
<section id="portfolio-total-risk" class="level2" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="portfolio-total-risk"><span class="header-section-number">5</span> Portfolio Total Risk</h2>
<p>Now we arrive at the central insight of portfolio theory: how risk combines across assets. Unlike expected returns, which combine as a simple weighted average, portfolio risk depends on the correlations between assets in complex and often counterintuitive ways.</p>
<p>The variance of a portfolio’s return is given by:</p>
<p><span class="math display">\[Var[R_P] = \sum_{i=1}^{N} w_i^2 Var[R_i] + \sum_{i \neq j} w_i w_j Cov[R_i, R_j]\]</span></p>
<p>where <span class="math inline">\(Var[R_P]\)</span> is the portfolio variance, <span class="math inline">\(w_i\)</span> is the weight of asset <span class="math inline">\(i\)</span>, <span class="math inline">\(Var[R_i]\)</span> is the variance of asset <span class="math inline">\(i\)</span>’s returns, and <span class="math inline">\(Cov[R_i, R_j]\)</span> is the covariance between assets <span class="math inline">\(i\)</span> and <span class="math inline">\(j\)</span>. The portfolio standard deviation (total risk) is simply the square root of the variance: <span class="math inline">\(\sigma_P = \sqrt{Var[R_P]}\)</span>.</p>
<p>This formula has two distinct components. The first summation captures the individual risk contributions—each asset’s variance, scaled by its squared weight. The second summation captures the interaction effects—how pairs of assets move together, weighted by the product of their weights. The factor of 2 appears because each pair <span class="math inline">\((i,j)\)</span> contributes twice (once for <span class="math inline">\(i,j\)</span> and once for <span class="math inline">\(j,i\)</span>), and the formula accounts for both.</p>
<p>For a two-asset portfolio, the formula simplifies to:</p>
<p><span class="math display">\[Var[R_P] = w_1^2 Var[R_1] + w_2^2 Var[R_2] + 2w_1 w_2 Cov[R_1, R_2]\]</span></p>
<p>For a three-asset portfolio:</p>
<p><span class="math display">\[Var[R_P] = w_1^2 Var[R_1] + w_2^2 Var[R_2] + w_3^2 Var[R_3] + 2w_1 w_2 Cov[R_1, R_2] + 2w_1 w_3 Cov[R_1, R_3] + 2w_2 w_3 Cov[R_2, R_3]\]</span></p>
<p>The covariance terms are where the magic of diversification happens. When covariances are less than perfect (which is almost always the case), the portfolio variance will be less than the weighted average of the individual variances. In the extreme case where two assets have a correlation of -1, you can construct a portfolio with zero variance—a risk-free portfolio from risky assets! While such perfect negative correlations are rare in practice, even modest positive correlations below 1 provide meaningful diversification benefits.</p>
<p>This is why covariance is so important: it determines how much risk you can eliminate through diversification. The lower the covariances between your assets, the more your portfolio’s risk will fall below what you might naively expect from averaging the individual risks.</p>
<p><strong>Example 4</strong></p>
<p><em>Suppose over the past three months META had returns of 10%, 10%, and -8%, and NFLX had returns of 20%, -10%, and -1%. Today, you invest $1,000 in META and $4,000 in NFLX. What is the total risk of your portfolio?</em></p>
<div class="callout callout-style-default callout-note callout-titled" title="Solution">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-4-contents" aria-controls="callout-4" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-4" class="callout-4-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><strong>Step 1: Identify portfolio weights (from Example 2)</strong></p>
<ul>
<li><span class="math inline">\(w_{META} = 0.20\)</span> (20%)</li>
<li><span class="math inline">\(w_{NFLX} = 0.80\)</span> (80%)</li>
</ul>
<p><strong>Step 2: Recall or calculate variances (from Example 3)</strong></p>
<ul>
<li><span class="math inline">\(Var^{META} = 0.0108\)</span></li>
<li><span class="math inline">\(Var^{NFLX} = 0.0237\)</span></li>
<li><span class="math inline">\(Cov_{META,NFLX} = 0.0036\)</span></li>
</ul>
<p><strong>Step 3: Apply the two-asset portfolio variance formula</strong></p>
<p><span class="math display">\[Var[R_P] = w_{META}^2 \times Var^{META} + w_{NFLX}^2 \times Var^{NFLX} + 2 \times w_{META} \times w_{NFLX} \times Cov_{META,NFLX}\]</span></p>
<p><span class="math display">\[Var[R_P] = (0.20)^2 \times 0.0108 + (0.80)^2 \times 0.0237 + 2 \times 0.20 \times 0.80 \times 0.0036\]</span></p>
<p><span class="math display">\[Var[R_P] = 0.04 \times 0.0108 + 0.64 \times 0.0237 + 0.32 \times 0.0036\]</span></p>
<p><span class="math display">\[Var[R_P] = 0.000432 + 0.015168 + 0.001152\]</span></p>
<p><span class="math display">\[Var[R_P] = 0.016752\]</span></p>
<p><strong>Step 4: Calculate portfolio standard deviation</strong></p>
<p><span class="math display">\[\sigma_P = \sqrt{0.016752} = 0.1294 = 12.94\%\]</span></p>
<p><strong>Step 5: Verify diversification benefit</strong></p>
<p>Let’s compare to what the risk would be if we simply weighted the standard deviations:</p>
<p>Weighted average of standard deviations: <span class="math inline">\(0.20 \times 10.39\% + 0.80 \times 15.39\% = 2.08\% + 12.31\% = 14.39\%\)</span></p>
<p>Actual portfolio standard deviation: 12.94%</p>
<p><strong>The portfolio standard deviation (12.94%) is less than the weighted average of individual standard deviations (14.39%), demonstrating the risk reduction benefit of diversification.</strong> This occurs because the correlation between META and NFLX is less than 1 (we calculated it as 0.225 in Example 3).</p>
</div>
</div>
</div>
</section>
<section id="key-takeaways" class="level2" data-number="6">
<h2 data-number="6" class="anchored" data-anchor-id="key-takeaways"><span class="header-section-number">6</span> Key Takeaways</h2>
<p>Portfolio analysis builds on a simple foundation—weights determine how much each asset matters—but leads to profound insights about how risk and return combine. The return side is straightforward: a portfolio’s expected return is just a weighted average of its components’ expected returns. You cannot manufacture expected return through portfolio construction; you can only choose where to position yourself between your highest- and lowest-returning assets.</p>
<p>Risk behaves very differently. While individual asset variances contribute to portfolio variance, so do the covariances between every pair of assets. This creates the possibility of diversification: when assets don’t move in perfect lockstep, combining them produces a portfolio less volatile than you might expect. The mathematics shows this clearly—the covariance terms in the portfolio variance formula can substantially reduce total risk when correlations are low.</p>
<p>This distinction between return (which averages simply) and risk (which depends on co-movement) is the central insight of modern portfolio theory. It explains why diversification is often called the only “free lunch” in finance: you can reduce risk without sacrificing expected return, simply by combining assets that don’t move together perfectly.</p>
<p>Remember too that portfolios are dynamic. Weights change as prices change, meaning that multi-period calculations require updating weights after each period. A portfolio that starts with equal weights will drift toward overweighting winners and underweighting losers unless actively rebalanced.</p>
</section>
<section id="key-formulas-summary" class="level2" data-number="7">
<h2 data-number="7" class="anchored" data-anchor-id="key-formulas-summary"><span class="header-section-number">7</span> Key Formulas Summary</h2>
<table class="table">
<colgroup>
<col style="width: 29%">
<col style="width: 29%">
<col style="width: 41%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Concept</th>
<th style="text-align: left;">Formula</th>
<th style="text-align: left;">When to Use</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Portfolio weight</td>
<td style="text-align: left;"><span class="math inline">\(w_i = \frac{M_i}{\sum_{j=1}^{N} M_j}\)</span></td>
<td style="text-align: left;">Finding each asset’s fraction of total portfolio value</td>
</tr>
<tr class="even">
<td style="text-align: left;">Portfolio realized return</td>
<td style="text-align: left;"><span class="math inline">\(R_P = \sum_{i=1}^{N} w_i R_i\)</span></td>
<td style="text-align: left;">Calculating the actual return over a specific period</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Portfolio expected return</td>
<td style="text-align: left;"><span class="math inline">\(E[R_P] = \sum_{i=1}^{N} w_i E[R_i]\)</span></td>
<td style="text-align: left;">Estimating future average portfolio returns</td>
</tr>
<tr class="even">
<td style="text-align: left;">Sample covariance</td>
<td style="text-align: left;"><span class="math inline">\(Cov_{A,B} = \frac{\sum_{t=1}^{N}(R_t^A - \bar{R}^A)(R_t^B - \bar{R}^B)}{N-1}\)</span></td>
<td style="text-align: left;">Measuring how two assets move together</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Correlation</td>
<td style="text-align: left;"><span class="math inline">\(Corr_{A,B} = \frac{Cov_{A,B}}{\sigma^A \sigma^B}\)</span></td>
<td style="text-align: left;">Standardizing covariance for easier interpretation</td>
</tr>
<tr class="even">
<td style="text-align: left;">Portfolio variance (general)</td>
<td style="text-align: left;"><span class="math inline">\(Var[R_P] = \sum_{i=1}^{N} w_i^2 Var[R_i] + \sum_{i \neq j} w_i w_j Cov[R_i, R_j]\)</span></td>
<td style="text-align: left;">Calculating total portfolio risk for any number of assets</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Portfolio variance (2 assets)</td>
<td style="text-align: left;"><span class="math inline">\(Var[R_P] = w_1^2 Var[R_1] + w_2^2 Var[R_2] + 2w_1 w_2 Cov[R_1, R_2]\)</span></td>
<td style="text-align: left;">Calculating risk for a two-asset portfolio</td>
</tr>
<tr class="even">
<td style="text-align: left;">Portfolio standard deviation</td>
<td style="text-align: left;"><span class="math inline">\(\sigma_P = \sqrt{Var[R_P]}\)</span></td>
<td style="text-align: left;">Converting variance to interpretable risk measure</td>
</tr>
</tbody>
</table>
</section>
<section id="practice-problems" class="level2" data-number="8">
<h2 data-number="8" class="anchored" data-anchor-id="practice-problems"><span class="header-section-number">8</span> Practice Problems</h2>
<p><strong>Practice Problem 1: Portfolio Realized Returns</strong></p>
<p><em>You purchase 100 shares of Apple (AAPL) at $150 per share and 50 shares of Microsoft (MSFT) at $300 per share. In the first quarter, AAPL returns 8% and MSFT returns -4%. In the second quarter, AAPL returns -5% and MSFT returns 12%. Calculate the portfolio return for each quarter and the total return over the two-quarter period.</em></p>
<div class="callout callout-style-default callout-note callout-titled" title="Solution">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-5-contents" aria-controls="callout-5" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-5" class="callout-5-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><strong>Step 1: Calculate initial portfolio values and weights</strong></p>
<p>At the start of Q1:</p>
<ul>
<li>AAPL: 100 shares × $150 = $15,000</li>
<li>MSFT: 50 shares × $300 = $15,000</li>
<li>Total portfolio value: $30,000</li>
</ul>
<p>Initial weights:</p>
<ul>
<li><span class="math inline">\(w_{AAPL} = \$15,000 / \$30,000 = 0.50\)</span> (50%)</li>
<li><span class="math inline">\(w_{MSFT} = \$15,000 / \$30,000 = 0.50\)</span> (50%)</li>
</ul>
<p><strong>Step 2: Calculate Q1 return</strong></p>
<p><span class="math display">\[R_{P,Q1} = 0.50 \times 8\% + 0.50 \times (-4\%) = 4\% - 2\% = 2\%\]</span></p>
<p><strong>Step 3: Calculate new portfolio values and weights for Q2</strong></p>
<p>At the end of Q1:</p>
<ul>
<li>AAPL value: $15,000 × 1.08 = $16,200</li>
<li>MSFT value: $15,000 × 0.96 = $14,400</li>
<li>Total portfolio value: $30,600</li>
</ul>
<p>New weights:</p>
<ul>
<li><span class="math inline">\(w_{AAPL} = \$16,200 / \$30,600 = 0.529\)</span> (52.9%)</li>
<li><span class="math inline">\(w_{MSFT} = \$14,400 / \$30,600 = 0.471\)</span> (47.1%)</li>
</ul>
<p><strong>Step 4: Calculate Q2 return</strong></p>
<p><span class="math display">\[R_{P,Q2} = 0.529 \times (-5\%) + 0.471 \times 12\% = -2.65\% + 5.65\% = 3.00\%\]</span></p>
<p><strong>Step 5: Calculate total two-quarter return</strong></p>
<p><span class="math display">\[R_{total} = (1 + 0.02) \times (1 + 0.03) - 1 = 1.02 \times 1.03 - 1 = 1.0506 - 1 = 5.06\%\]</span></p>
<p><strong>Summary:</strong> Q1 return = 2%, Q2 return = 3%, Total two-quarter return = 5.06%</p>
</div>
</div>
</div>
<p><strong>Practice Problem 2: Portfolio Expected Returns</strong></p>
<p><em>Over the past four months, Stock X had returns of 5%, -3%, 8%, and 2%, while Stock Y had returns of -2%, 6%, 4%, and 0%. You invest $6,000 in Stock X and $9,000 in Stock Y. What is the expected return of your portfolio?</em></p>
<div class="callout callout-style-default callout-note callout-titled" title="Solution">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-6-contents" aria-controls="callout-6" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-6" class="callout-6-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><strong>Step 1: Calculate portfolio weights</strong></p>
<ul>
<li>Total investment: $6,000 + $9,000 = $15,000</li>
<li><span class="math inline">\(w_X = \$6,000 / \$15,000 = 0.40\)</span> (40%)</li>
<li><span class="math inline">\(w_Y = \$9,000 / \$15,000 = 0.60\)</span> (60%)</li>
</ul>
<p><strong>Step 2: Estimate expected returns using historical averages</strong></p>
<p>For Stock X: <span class="math display">\[E[R_X] = \frac{5\% + (-3\%) + 8\% + 2\%}{4} = \frac{12\%}{4} = 3\%\]</span></p>
<p>For Stock Y: <span class="math display">\[E[R_Y] = \frac{(-2\%) + 6\% + 4\% + 0\%}{4} = \frac{8\%}{4} = 2\%\]</span></p>
<p><strong>Step 3: Calculate expected portfolio return</strong></p>
<p><span class="math display">\[E[R_P] = 0.40 \times 3\% + 0.60 \times 2\% = 1.2\% + 1.2\% = 2.4\%\]</span></p>
<p><strong>The expected return of the portfolio is 2.4% per month.</strong></p>
</div>
</div>
</div>
<p><strong>Practice Problem 3: Covariance and Correlation</strong></p>
<p><em>Over the past four months, Stock X had returns of 5%, -3%, 8%, and 2%, while Stock Y had returns of -2%, 6%, 4%, and 0%. Calculate the sample covariance and correlation between the returns of Stock X and Stock Y.</em></p>
<div class="callout callout-style-default callout-note callout-titled" title="Solution">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-7-contents" aria-controls="callout-7" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-7" class="callout-7-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><strong>Step 1: Calculate sample means (from Practice Problem 2)</strong></p>
<ul>
<li><span class="math inline">\(\bar{R}^X = 3\%\)</span></li>
<li><span class="math inline">\(\bar{R}^Y = 2\%\)</span></li>
</ul>
<p><strong>Step 2: Calculate deviations from the mean</strong></p>
<table class="table">
<thead>
<tr class="header">
<th style="text-align: left;">Month</th>
<th style="text-align: left;"><span class="math inline">\(R^X\)</span></th>
<th style="text-align: left;"><span class="math inline">\(R^Y\)</span></th>
<th style="text-align: left;"><span class="math inline">\(R^X - \bar{R}^X\)</span></th>
<th style="text-align: left;"><span class="math inline">\(R^Y - \bar{R}^Y\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1</td>
<td style="text-align: left;">5%</td>
<td style="text-align: left;">-2%</td>
<td style="text-align: left;">2%</td>
<td style="text-align: left;">-4%</td>
</tr>
<tr class="even">
<td style="text-align: left;">2</td>
<td style="text-align: left;">-3%</td>
<td style="text-align: left;">6%</td>
<td style="text-align: left;">-6%</td>
<td style="text-align: left;">4%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">3</td>
<td style="text-align: left;">8%</td>
<td style="text-align: left;">4%</td>
<td style="text-align: left;">5%</td>
<td style="text-align: left;">2%</td>
</tr>
<tr class="even">
<td style="text-align: left;">4</td>
<td style="text-align: left;">2%</td>
<td style="text-align: left;">0%</td>
<td style="text-align: left;">-1%</td>
<td style="text-align: left;">-2%</td>
</tr>
</tbody>
</table>
<p><strong>Step 3: Calculate products of deviations</strong></p>
<table class="table">
<thead>
<tr class="header">
<th style="text-align: left;">Month</th>
<th style="text-align: left;"><span class="math inline">\((R^X - \bar{R}^X) \times (R^Y - \bar{R}^Y)\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1</td>
<td style="text-align: left;">2% × (-4%) = -0.0008</td>
</tr>
<tr class="even">
<td style="text-align: left;">2</td>
<td style="text-align: left;">(-6%) × 4% = -0.0024</td>
</tr>
<tr class="odd">
<td style="text-align: left;">3</td>
<td style="text-align: left;">5% × 2% = 0.0010</td>
</tr>
<tr class="even">
<td style="text-align: left;">4</td>
<td style="text-align: left;">(-1%) × (-2%) = 0.0002</td>
</tr>
</tbody>
</table>
<p>Sum of products: -0.0008 + (-0.0024) + 0.0010 + 0.0002 = -0.0020</p>
<p><strong>Step 4: Calculate sample covariance</strong></p>
<p><span class="math display">\[Cov_{X,Y} = \frac{-0.0020}{4-1} = \frac{-0.0020}{3} = -0.000667\]</span></p>
<p><strong>Step 5: Calculate standard deviations</strong></p>
<p>For Stock X: <span class="math display">\[Var^X = \frac{(2\%)^2 + (-6\%)^2 + (5\%)^2 + (-1\%)^2}{3} = \frac{0.0004 + 0.0036 + 0.0025 + 0.0001}{3} = \frac{0.0066}{3} = 0.0022\]</span></p>
<p><span class="math display">\[\sigma^X = \sqrt{0.0022} = 0.0469 = 4.69\%\]</span></p>
<p>For Stock Y: <span class="math display">\[Var^Y = \frac{(-4\%)^2 + (4\%)^2 + (2\%)^2 + (-2\%)^2}{3} = \frac{0.0016 + 0.0016 + 0.0004 + 0.0004}{3} = \frac{0.0040}{3} = 0.00133\]</span></p>
<p><span class="math display">\[\sigma^Y = \sqrt{0.00133} = 0.0365 = 3.65\%\]</span></p>
<p><strong>Step 6: Calculate correlation</strong></p>
<p><span class="math display">\[Corr_{X,Y} = \frac{-0.000667}{0.0469 \times 0.0365} = \frac{-0.000667}{0.00171} = -0.39\]</span></p>
<p><strong>Summary:</strong></p>
<ul>
<li>Sample covariance = -0.000667 (or -0.067%)</li>
<li>Sample correlation = -0.39</li>
</ul>
<p>The negative correlation indicates that when Stock X performs well, Stock Y tends to perform poorly, and vice versa. This makes these two stocks excellent diversification partners!</p>
</div>
</div>
</div>
<p><strong>Practice Problem 4: Portfolio Total Risk</strong></p>
<p><em>Using the data from Practice Problems 2 and 3 (Stock X and Stock Y with weights of 40% and 60% respectively), calculate the total risk (standard deviation) of the portfolio.</em></p>
<div class="callout callout-style-default callout-note callout-titled" title="Solution">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-8-contents" aria-controls="callout-8" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-8" class="callout-8-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><strong>Step 1: Identify inputs</strong></p>
<p>From previous problems:</p>
<ul>
<li><span class="math inline">\(w_X = 0.40\)</span>, <span class="math inline">\(w_Y = 0.60\)</span></li>
<li><span class="math inline">\(Var^X = 0.0022\)</span></li>
<li><span class="math inline">\(Var^Y = 0.00133\)</span></li>
<li><span class="math inline">\(Cov_{X,Y} = -0.000667\)</span></li>
</ul>
<p><strong>Step 2: Apply the two-asset portfolio variance formula</strong></p>
<p><span class="math display">\[Var[R_P] = w_X^2 \times Var^X + w_Y^2 \times Var^Y + 2 \times w_X \times w_Y \times Cov_{X,Y}\]</span></p>
<p><span class="math display">\[Var[R_P] = (0.40)^2 \times 0.0022 + (0.60)^2 \times 0.00133 + 2 \times 0.40 \times 0.60 \times (-0.000667)\]</span></p>
<p><span class="math display">\[Var[R_P] = 0.16 \times 0.0022 + 0.36 \times 0.00133 + 0.48 \times (-0.000667)\]</span></p>
<p><span class="math display">\[Var[R_P] = 0.000352 + 0.000479 - 0.000320\]</span></p>
<p><span class="math display">\[Var[R_P] = 0.000511\]</span></p>
<p><strong>Step 3: Calculate portfolio standard deviation</strong></p>
<p><span class="math display">\[\sigma_P = \sqrt{0.000511} = 0.0226 = 2.26\%\]</span></p>
<p><strong>Step 4: Demonstrate diversification benefit</strong></p>
<p>Weighted average of standard deviations: <span class="math inline">\(0.40 \times 4.69\% + 0.60 \times 3.65\% = 1.88\% + 2.19\% = 4.07\%\)</span></p>
<p>Actual portfolio standard deviation: 2.26%</p>
<p><strong>The portfolio standard deviation (2.26%) is dramatically lower than the weighted average of individual standard deviations (4.07%).</strong> This exceptional diversification benefit occurs because the correlation between X and Y is negative (-0.39), meaning the stocks tend to move in opposite directions, partially offsetting each other’s volatility.</p>
</div>
</div>
</div>
</section>
<section id="ask-an-llm" class="level2" data-number="9">
<h2 data-number="9" class="anchored" data-anchor-id="ask-an-llm"><span class="header-section-number">9</span> Ask an LLM</h2>
<p>Here are three questions you might ask an AI assistant to deepen your understanding of these concepts:</p>
<ul>
<li>What happens to portfolio risk as I add more and more assets with the same expected return and variance but zero correlation with each other? Is there a limit to how much I can reduce risk through diversification?</li>
<li>Can you explain intuitively why portfolio variance uses squared weights for individual variances but only single weights (multiplied together) for covariance terms?</li>
<li>If I have three assets and I know all the pairwise correlations are exactly 0.5, how would I calculate the portfolio variance, and what does this moderate positive correlation imply about my diversification benefits?</li>
<li>How do professional portfolio managers estimate expected returns and covariances for hundreds of assets, and what are the challenges with using historical data for these estimates?</li>
</ul>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>